# OpenSearch Dashboards Production Configuration
# Mount this file to /usr/share/opensearch-dashboards/config/opensearch_dashboards.yml
#
# This configuration enables:
#   - Security plugin with authentication
#   - Multitenancy for tenant isolation
#   - TLS for secure communication with OpenSearch

server.host: "0.0.0.0"
server.port: 5601

# Base path configuration for reverse proxy
server.basePath: "/analytics"
server.rewriteBasePath: true

# OpenSearch connection (HTTPS for production)
opensearch.hosts: ["https://opensearch:9200"]

# TLS Configuration - trust the CA certificate
opensearch.ssl.verificationMode: certificate
opensearch.ssl.certificateAuthorities: ["/usr/share/opensearch-dashboards/config/certs/root-ca.pem"]

# Authentication - use OpenSearch Security plugin
opensearch.username: "kibanaserver"
opensearch.password: "${OPENSEARCH_DASHBOARDS_PASSWORD}"
opensearch.requestHeadersWhitelist: ["securitytenant", "Authorization"]

# Security Plugin Configuration - SaaS Multitenancy
# Each customer gets their own isolated tenant - no shared data by default
opensearch_security.multitenancy.enabled: true
opensearch_security.multitenancy.tenants.enable_global: false
opensearch_security.multitenancy.tenants.enable_private: true
opensearch_security.multitenancy.tenants.preferred: ["Private"]
opensearch_security.readonly_mode.roles: ["kibana_read_only"]
opensearch_security.cookie.secure: true
opensearch_security.cookie.isSameSite: "Strict"

# Tenant isolation - users only see their tenant's dashboards
# Backend creates tenant dynamically per customer (tenant name = customer ID)

# Session configuration
opensearch_security.session.ttl: 3600000
opensearch_security.session.keepalive: true

# Logging
logging.dest: stdout
logging.silent: false
logging.quiet: false
logging.verbose: false

# Telemetry (disable for production privacy)
telemetry.enabled: false
telemetry.allowChangingOptInStatus: false

# CSP headers for security
csp.strict: true
csp.warnLegacyBrowsers: true

version: '3.8'

services:
  # AWS Suite
  aws-suite:
    build:
      context: ./mcp-aws-suite
      dockerfile: Dockerfile
      args:
        BASE_IMAGE: shipsec/mcp-stdio-proxy:latest
    ports:
      - '8081:8080'
    environment:
      - MCP_COMMAND=${MCP_AWS_COMMAND:-awslabs.cloudtrail-mcp-server}
      - MCP_ARGS=${MCP_AWS_ARGS:-[]}
      - PORT=8080
    volumes:
      - ./mcp-aws-suite:/app
    restart: unless-stopped
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:8080/health']
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

  # stdio proxy (base service)
  mcp-stdio-proxy:
    build:
      context: ./mcp-stdio-proxy
      dockerfile: Dockerfile
    ports:
      - '8080:8080'
    volumes:
      - ./mcp-stdio-proxy:/app
    restart: unless-stopped
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:8080/health']
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

# Frontend Load Testing Audit Report

**Date:** 2026-02-18
**Branch:** `LuD1161/tanstack-query-migrate`
**Seed Tier:** Medium (50 workflows, ~2000 runs, ~45K traces, ~17K node I/O, ~45K agent events)
**Environment:** Nginx reverse proxy (localhost:80 → Vite dev server), no CPU/network throttling
**Seed Duration:** 20.3s
**Testing Plan:** See `frontend/docs/load-testing-plan.md`

---

## 1. Workflow List Page (`/`)

### 1.1 Performance Trace Summary (Lighthouse-style)

| Metric   | Value        | Rating |
| -------- | ------------ | ------ |
| **LCP**  | **4,893 ms** | POOR   |
| **CLS**  | 0.00         | GOOD   |
| **TTFB** | **54 ms**    | GOOD   |

### 1.2 LCP Breakdown

- **TTFB:** 54 ms (1.1% of LCP)
- **Render Delay:** 4,839 ms (98.9% of LCP) — the main bottleneck
- Max critical path latency: **4,577 ms** — dominated by Vite module chain loading
- LCP element: `<P class='text-sm md:text-base text-muted-foreground'>` (text, not network-fetched)

> **Note:** The 4.9s LCP is dominated by Vite's unbundled ESM module chain. The critical path goes through `main.tsx → App.tsx → AppLayout.tsx → prefetch-routes.ts → SchedulesPage.tsx` etc. A production build would dramatically reduce this. The previous audit via Vite direct showed 9.7s LCP, so nginx proxy already improved it by ~2x.

### 1.3 API Request Timings

| #   | Endpoint                    | Status |
| --- | --------------------------- | ------ |
| 1   | `/api/v1/workflows/summary` | 200 OK |
| 2   | `/api/v1/components`        | 200 OK |

**Observations:**

- Only **2 API calls** on the list page — efficient!
- All **50 workflows** are loaded in a single request — no pagination
- Both responses use gzip compression via nginx

### 1.4 TanStack Query Cache (on list page)

| Query Key                          | Status  | Stale Time    | Is Stale | Data     |
| ---------------------------------- | ------- | ------------- | -------- | -------- |
| `["components","local-dev"]`       | success | 600s (10 min) | false    | object   |
| `["workflowsSummary","local-dev"]` | success | 60s (1 min)   | false    | 50 items |

**Observations:**

- Components cache is well-configured at 10 min stale time (rarely changes)
- Workflows summary has 60s stale time — refreshes frequently on tab focus, good for live data
- Prefetch is working correctly via `usePrefetchOnIdle`
- **Clean cache — no ghost queries on this page**

### 1.5 DOM Size: **1,529 elements**

### 1.6 Third-Party Impact

Only **Google Fonts** (48.4 KB). Minimal third-party overhead.

### 1.7 Critical Path Analysis

The network dependency tree shows the critical chain:

```
localhost/ (66ms)
  └─ main.tsx (267ms)
     └─ react_jsx-dev-runtime (268ms)
        └─ chunk-UV2NTXO5 (272ms)
           └─ WorkflowList.tsx (4,569ms) ← bottleneck
              └─ statusBadgeStyles.ts (4,577ms)
```

The `prefetch-routes.ts` module eagerly loads ALL page modules (SchedulesPage, McpLibraryPage, ArtifactLibrary, WebhooksPage, etc.), adding significant module chain depth. This is a Vite dev-mode issue — production bundles would chunk differently.

---

## 2. Workflow Detail Page — Design Tab (`/workflows/:id`)

### 2.1 API Requests on SPA Navigation

| #   | Endpoint                           | Notes                                           |
| --- | ---------------------------------- | ----------------------------------------------- |
| 1   | `/api/v1/workflows/summary`        | **Served from TanStack cache** (not re-fetched) |
| 2   | `/api/v1/components`               | **Served from TanStack cache** (not re-fetched) |
| 3   | `/api/v1/secrets`                  | New fetch — 0 items                             |
| 4   | `/api/v1/schedules`                | New fetch — 30 items                            |
| 5   | `/api/v1/workflows/:id`            | Full workflow with graph — large payload        |
| 6   | `/api/v1/schedules?workflowId=:id` | Workflow-specific schedules — 0 items           |

**Observations:**

- 4 new API calls on SPA navigation (2 cached from prefetch)
- Cache reuse for `workflows/summary` and `components` is working correctly
- The workflow detail response includes the **full graph JSON**

### 2.2 TanStack Query Cache (on design tab) — 7 queries

| Query Key                                     | Status      | Stale Time | Is Stale | Data      | Issue?          |
| --------------------------------------------- | ----------- | ---------- | -------- | --------- | --------------- |
| `["components","local-dev"]`                  | success     | 600s       | false    | object    |                 |
| `["workflowsSummary","local-dev"]`            | success     | 60s        | false    | 50 items  |                 |
| `["secrets","local-dev"]`                     | success     | 300s       | false    | 0 items   |                 |
| `["schedules","local-dev",{}]`                | success     | 60s        | false    | 30 items  |                 |
| `["schedules","local-dev",{workflowId}]`      | success     | 60s        | false    | 0 items   |                 |
| **`["runs","local-dev","__disabled__"]`**     | **PENDING** | 30s        | false    | undefined | **Ghost query** |
| **`["workflow","local-dev","__disabled__"]`** | **PENDING** | 60s        | false    | undefined | **Ghost query** |

### FINDINGS — Ghost Queries:

1. **`["runs","local-dev","__disabled__"]`** — Query created with `status: pending` + `fetchStatus: idle`. The `__disabled__` sentinel indicates the query is deliberately disabled (via `enabled: false` when no run is selected), but the cache entry persists.

2. **`["workflow","local-dev","__disabled__"]`** — Same pattern. A disabled sentinel key sitting idle in cache.

### 2.3 DOM Size: **1,667 elements**

---

## 3. Workflow Detail Page — Execute Tab (`/workflows/:id/runs/:runId`)

### 3.1 API Requests on Execute Tab Switch

| #   | Endpoint                                        | Notes                      |
| --- | ----------------------------------------------- | -------------------------- |
| 1   | `/api/v1/workflows/runs?workflowId=:id&limit=5` | Run selector (last 5 runs) |
| 2   | `/api/v1/workflows/runs/:runId/events`          | Event timeline             |
| 3   | `/api/v1/workflows/runs/:runId/dataflows`       | Node I/O data              |
| 4   | `/api/v1/workflows/runs/:runId/status`          | Run status                 |
| 5   | `/api/v1/workflows/:id/versions/:versionId`     | Workflow version           |
| 6   | `/api/v1/workflows/runs/:runId/stream`          | Live event stream (SSE)    |
| 7   | `/api/v1/workflows/runs/:runId/events`          | **DUPLICATE**              |
| 8   | `/api/v1/workflows/runs/:runId/dataflows`       | **DUPLICATE**              |
| 9   | `/api/v1/workflows/runs/:runId/status`          | **DUPLICATE**              |
| 10  | `/api/v1/workflows/runs/:runId/logs?limit=500`  | Logs                       |

### FINDING: Duplicate API Calls (PERSISTS)

The Execute tab fires **duplicate requests** for multiple endpoints:

- **`events`** called **2 times**
- **`dataflows`** called **2 times**
- **`status`** called **2 times**

This suggests component re-renders triggering refetches or multiple components independently querying the same run data. TanStack Query deduplication should prevent this — investigate if `enabled` flags are toggling or if queryFn differs across instances.

### 3.2 TanStack Query Cache (on execute tab) — 9 queries

| Query Key                                 | Status  | Stale Time | Is Stale | Notes             |
| ----------------------------------------- | ------- | ---------- | -------- | ----------------- |
| `["components","local-dev"]`              | success | 600s       | false    |                   |
| `["workflowsSummary","local-dev"]`        | success | 60s        | false    |                   |
| `["secrets","local-dev"]`                 | success | 300s       | false    |                   |
| `["schedules","local-dev",{}]`            | success | 60s        | false    |                   |
| `["schedules","local-dev",{workflowId}]`  | success | 60s        | false    |                   |
| `["runs","local-dev","__disabled__"]`     | PENDING | 30s        | false    | Ghost             |
| `["workflow","local-dev","__disabled__"]` | PENDING | 60s        | **true** | Ghost, stale      |
| `["runs","local-dev",":workflowId"]`      | success | 30s        | **true** | Actively fetching |
| `["runs","local-dev","detail",":runId"]`  | success | 30s        | false    |                   |

### 3.3 DOM Size: **2,091 elements** — highest of any page

### 3.4 Run Selector Pagination

The run selector fetches with `limit=5`, which is efficient. Good pagination strategy.

---

## 4. Mobile Responsiveness (375px iPhone, 768px Tablet)

### 4.1 iPhone (375px)

- Sidebar collapses correctly to a hamburger menu ("Open menu" button)
- Table columns adapted: **"Last Run" and "Last Updated" columns hidden**
- Only shows: Name, Nodes, Status, Actions
- Long workflow names (e.g., "Content Publisher - User Health Inventory...") wrap correctly
- Mobile-specific top bar with "ShipSec Studio" logo and "New" button visible
- **All 50 workflows** rendered — no virtual scrolling on mobile (potential scroll jank)

### 4.2 Tablet (768px)

- Sidebar collapsed
- Table shows more columns than mobile but less than desktop
- Layout is functional

### 4.3 Mobile Performance Concern

Rendering 50 workflow rows without virtualization is particularly problematic on mobile devices with constrained GPU/CPU. The 1,529 DOM elements could cause scroll jank on older devices.

---

## 5. Schedules Page (`/schedules`)

### 5.1 API Requests

| #   | Endpoint                    | Status |
| --- | --------------------------- | ------ |
| 1   | `/api/v1/workflows/summary` | 200 OK |
| 2   | `/api/v1/components`        | 200 OK |
| 3   | `/api/v1/schedules`         | 200 OK |

- **3 API calls total** — clean, no duplicates
- 30 schedules loaded in a single request

### 5.2 TanStack Query Cache

| Query Key                                     | Status      | Stale Time | Is Stale | Data      |
| --------------------------------------------- | ----------- | ---------- | -------- | --------- |
| `["components","local-dev"]`                  | success     | 600s       | false    | object    |
| `["workflowsSummary","local-dev"]`            | success     | 60s        | false    | 50 items  |
| `["schedules","local-dev",{}]`                | success     | 60s        | false    | 30 items  |
| **`["workflow","local-dev","__disabled__"]`** | **PENDING** | 60s        | false    | undefined |

- Ghost query `["workflow","__disabled__"]` persists across page navigations — confirmed global issue

### 5.3 DOM Size: **1,452 elements**

---

## 6. Webhooks Page (`/webhooks`)

### 6.1 API Requests

| #   | Endpoint                          | Status |
| --- | --------------------------------- | ------ |
| 1   | `/api/v1/workflows/summary`       | 200 OK |
| 2   | `/api/v1/components`              | 200 OK |
| 3   | `/api/v1/webhooks/configurations` | 200 OK |

- **3 API calls total** — all fast
- 25 webhooks loaded — no pagination

### 6.2 TanStack Query Cache

| Query Key                          | Status  | Stale Time | Is Stale | Data     |
| ---------------------------------- | ------- | ---------- | -------- | -------- |
| `["components","local-dev"]`       | success | 600s       | false    | object   |
| `["workflowsSummary","local-dev"]` | success | 60s        | false    | 50 items |
| `["webhooks","local-dev",null]`    | success | 60s        | false    | 25 items |

- **Clean cache — no ghost queries on this page**
- Webhooks stale time improved from 15s → 60s since previous audit

### 6.3 DOM Size: **1,178 elements**

---

## 7. Action Center Page (`/action-center`)

### 7.1 API Requests

| #   | Endpoint                              | Status |
| --- | ------------------------------------- | ------ |
| 1   | `/api/v1/workflows/summary`           | 200 OK |
| 2   | `/api/v1/components`                  | 200 OK |
| 3   | `/api/v1/human-inputs?status=pending` | 200 OK |

- **3 API calls total**
- 28 pending human input items loaded

### 7.2 TanStack Query Cache

| Query Key                                          | Status  | Stale Time | Is Stale | Data     |
| -------------------------------------------------- | ------- | ---------- | -------- | -------- |
| `["components","local-dev"]`                       | success | 600s       | false    | object   |
| `["workflowsSummary","local-dev"]`                 | success | 60s        | false    | 50 items |
| `["humanInputs","local-dev",{"status":"pending"}]` | success | 30s        | false    | 28 items |

- Clean cache, no issues

### 7.3 DOM Size: **1,023 elements**

---

## 8. Artifact Library Page (`/artifacts`)

### 8.1 API Requests

| #   | Endpoint                    | Status |
| --- | --------------------------- | ------ |
| 1   | `/api/v1/workflows/summary` | 200 OK |
| 2   | `/api/v1/components`        | 200 OK |
| 3   | `/api/v1/artifacts`         | 200 OK |

- **3 API calls total**
- 50 artifacts loaded — no pagination

### 8.2 TanStack Query Cache

| Query Key                              | Status  | Stale Time | Is Stale | Data     |
| -------------------------------------- | ------- | ---------- | -------- | -------- |
| `["components","local-dev"]`           | success | 600s       | false    | object   |
| `["workflowsSummary","local-dev"]`     | success | 60s        | false    | 50 items |
| `["artifactLibrary","local-dev",null]` | success | 30s        | false    | 50 items |

- Clean cache, no issues

### 8.3 DOM Size: **1,520 elements** (second highest after execute tab)

---

## 9. Manage Section

### 9.1 Secrets Page (`/secrets`)

| #   | Endpoint                    | Status |
| --- | --------------------------- | ------ |
| 1   | `/api/v1/workflows/summary` | 200 OK |
| 2   | `/api/v1/components`        | 200 OK |
| 3   | `/api/v1/secrets`           | 200 OK |

- **3 API calls**, 0 secrets returned
- **Query:** `["secrets","local-dev"]` — success, 300s stale time (appropriate)
- **DOM Size:** **222 elements** — lightest page

### 9.2 API Keys Page (`/api-keys`)

| #   | Endpoint                    | Status |
| --- | --------------------------- | ------ |
| 1   | `/api/v1/workflows/summary` | 200 OK |
| 2   | `/api/v1/components`        | 200 OK |
| 3   | `/api/v1/api-keys`          | 200 OK |

- **3 API calls**, 0 API keys returned (seed data creates them but not in this org scope)
- **Query:** `["apiKeys","local-dev"]` — success, 60s stale time
- **DOM Size:** **212 elements** — lightest page in the app

### 9.3 MCP Library Page (`/mcp-library`)

| #   | Endpoint                                 | Status |
| --- | ---------------------------------------- | ------ |
| 1   | `/api/v1/workflows/summary`              | 200 OK |
| 2   | `/api/v1/components`                     | 200 OK |
| 3   | `/api/v1/mcp-groups/templates`           | 200 OK |
| 4   | `/api/v1/mcp-servers`                    | 200 OK |
| 5   | `/api/v1/mcp-servers/tools`              | 200 OK |
| 6   | `/api/v1/mcp-groups?includeServers=true` | 200 OK |

- **6 API calls** — most of any page (tied with Execute tab)
- `mcp-servers/tools` returns **268 items** — the largest item count from any single endpoint

**TanStack Query Cache:**

| Query Key                                 | Status  | Stale Time | Is Stale | Data      |
| ----------------------------------------- | ------- | ---------- | -------- | --------- |
| `["mcpGroupTemplates","local-dev"]`       | success | 300s       | false    | 1 item    |
| `["mcpServers","local-dev"]`              | success | 120s       | false    | 30 items  |
| `["mcpServers","local-dev","tools"]`      | success | 120s       | false    | 268 items |
| `["mcpGroups","local-dev","withServers"]` | success | 30s        | false    | 10 items  |

- **DOM Size:** **521 elements**

### 9.4 Analytics Settings Page (`/analytics-settings`)

| #   | Endpoint                    | Status |
| --- | --------------------------- | ------ |
| 1   | `/api/v1/workflows/summary` | 200 OK |
| 2   | `/api/v1/components`        | 200 OK |

- **2 API calls** — no page-specific API calls
- Only `components` and `workflowsSummary` (both prefetched)
- **No page-specific TanStack queries**
- **DOM Size:** **249 elements**

---

## 10. Cross-Page Analysis

### 10.1 DOM Element Count Comparison

| Page                                       | DOM Elements | Rating       |
| ------------------------------------------ | ------------ | ------------ |
| **Workflow Execute Tab**                   | **2,091**    | **Heaviest** |
| Workflow Detail Design                     | 1,667        | Heavy        |
| Workflow List (`/`)                        | 1,529        | Heavy        |
| Artifact Library (`/artifacts`)            | 1,520        | Heavy        |
| Schedules (`/schedules`)                   | 1,452        | Heavy        |
| Webhooks (`/webhooks`)                     | 1,178        | Moderate     |
| Action Center (`/action-center`)           | 1,023        | Moderate     |
| MCP Library (`/mcp-library`)               | 521          | Light        |
| Analytics Settings (`/analytics-settings`) | 249          | Minimal      |
| Secrets (`/secrets`)                       | 222          | Minimal      |
| API Keys (`/api-keys`)                     | 212          | Minimal      |

### 10.2 API Call Count per Page

| Page                    | API Calls | Notes                          |
| ----------------------- | --------- | ------------------------------ |
| Workflow Detail Execute | 10        | Includes 3 pairs of duplicates |
| MCP Library             | 6         | Most for a non-detail page     |
| Workflow Detail Design  | 6         | 4 new + 2 cached               |
| Schedules               | 3         |                                |
| Webhooks                | 3         |                                |
| Action Center           | 3         |                                |
| Artifact Library        | 3         |                                |
| Secrets                 | 3         |                                |
| API Keys                | 3         |                                |
| Workflow List           | 2         |                                |
| Analytics Settings      | 2         | No page-specific queries       |

### 10.3 Shared Queries Across All Pages

Every page loads `["components","local-dev"]` (600s stale) and `["workflowsSummary","local-dev"]` (60s stale) via `usePrefetchOnIdle`. This is consistent and efficient — the prefetch works correctly across all navigation paths.

### 10.4 Pages Without Pagination

| Page             | Items Loaded    | Pagination? |
| ---------------- | --------------- | ----------- |
| Workflow List    | 50 workflows    | **No**      |
| Schedules        | 30 schedules    | **No**      |
| Webhooks         | 25 webhooks     | **No**      |
| Action Center    | 28 human inputs | **No**      |
| Artifact Library | 50 artifacts    | **No**      |
| MCP Servers      | 30 servers      | **No**      |
| MCP Tools        | 268 tools       | **No**      |

> None of the list pages implement server-side pagination. Currently manageable at medium data volumes, but will become problematic at scale.

---

## 11. Summary of Findings

### What's Working Well

1. **TanStack Query caching** is effective — `components` (10 min stale) and `workflowsSummary` (60s stale) are properly cached and reused across SPA navigations
2. **Prefetch on idle** works — `usePrefetchOnIdle` correctly pre-fetches workflow summary and components on every page
3. **Auth gating** on prefetch appears functional
4. **Run selector pagination** — uses `limit=5`, efficient for workflow detail
5. **Gzip compression** active on all API responses via nginx
6. **CLS = 0.00** — no layout shifts, excellent UX
7. **Mobile responsive layout** — sidebar collapses, table columns adapt appropriately
8. **Stale time tuning** — most queries have appropriate stale times post-migration
9. **No unnecessary refetches** on SPA navigation — cache reuse is working

### Issues Found

| #   | Severity   | Finding                                             | Details                                                                                                                                                                                                                                |
| --- | ---------- | --------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | **MEDIUM** | Duplicate API calls on Execute tab                  | `events`, `dataflows`, `status` each called 2x on tab switch. TanStack deduplication not working for these. Total: 10 calls instead of expected 7.                                                                                     |
| 2   | **MEDIUM** | Ghost queries persist across navigations            | `["runs","__disabled__"]` and `["workflow","__disabled__"]` with status=pending, fetchStatus=idle. Found on Design tab and Schedules page. These use `__disabled__` sentinel (improved from `__global__`) but still pollute the cache. |
| 3   | **MEDIUM** | No pagination on ANY list page                      | Workflows (50), schedules (30), webhooks (25), artifacts (50), human inputs (28), MCP servers (30), MCP tools (268) — all loaded without pagination. Won't scale beyond ~200 items.                                                    |
| 4   | **LOW**    | LCP 4.9s in dev mode                                | Dominated by Vite module chain (4,577ms critical path). Production build expected to be significantly faster. Not a code issue.                                                                                                        |
| 5   | **LOW**    | `prefetch-routes.ts` eagerly loads ALL page modules | Adds to initial load time. All page components (Schedules, MCP, Artifacts, Webhooks, etc.) are loaded on first navigation regardless of which page the user visits.                                                                    |
| 6   | **LOW**    | No virtual scrolling for heavy pages                | Execute tab has 2,091 DOM elements, Workflow List 1,529, Artifacts 1,520. Could cause scroll performance issues at scale, especially on mobile.                                                                                        |
| 7   | **INFO**   | MCP tools payload: 268 items                        | Largest item count from any endpoint. Well-cached at 120s stale time. Compressed well via gzip.                                                                                                                                        |
| 8   | **INFO**   | Analytics Settings has no page-specific queries     | Only prefetched queries load — settings appear to be client-side only.                                                                                                                                                                 |

### Stale Time Configuration Summary (Current)

| Query               | Stale Time    | Assessment                                 |
| ------------------- | ------------- | ------------------------------------------ |
| `components`        | 600s (10 min) | Appropriate — rarely changes               |
| `workflowsSummary`  | 60s (1 min)   | Good for list page                         |
| `workflow` (detail) | 60s           | Good                                       |
| `secrets`           | 300s (5 min)  | Appropriate                                |
| `mcpGroupTemplates` | 300s (5 min)  | Appropriate                                |
| `schedules`         | 60s           | Good                                       |
| `mcpServers`        | 120s (2 min)  | Good                                       |
| `mcpServers/tools`  | 120s (2 min)  | Good                                       |
| `mcpGroups`         | 30s           | Acceptable                                 |
| `runs`              | 30s           | Good for potentially live data             |
| `webhooks`          | 60s           | Good (improved from 15s in previous audit) |
| `artifactLibrary`   | 30s           | Acceptable                                 |
| `humanInputs`       | 30s           | Good                                       |
| `apiKeys`           | 60s           | Good                                       |

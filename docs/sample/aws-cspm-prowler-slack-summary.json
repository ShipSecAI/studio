{
  "name": "AWS CSPM â€“ Prowler Scan to Slack Summary",
  "description": "Resolves AWS credentials from an integration connection, runs a Prowler security scan (high+critical severity), and sends a summary of findings to a Slack channel via an integration connection (OAuth or webhook).",
  "nodes": [
    {
      "id": "entry-1",
      "type": "core.workflow.entrypoint",
      "position": { "x": 300, "y": 50 },
      "data": {
        "label": "Entry Point",
        "config": {
          "params": {
            "runtimeInputs": [
              {
                "id": "connectionId",
                "label": "AWS Integration Connection ID",
                "type": "text",
                "required": true,
                "description": "The ID of the AWS integration connection. Find this in Settings > Integrations > AWS."
              },
              {
                "id": "regions",
                "label": "AWS Regions",
                "type": "text",
                "required": false,
                "description": "Comma-separated AWS regions to scan. Defaults to us-east-1.",
                "default": "us-east-1"
              },
              {
                "id": "slackConnectionId",
                "label": "Slack Integration Connection ID",
                "type": "text",
                "required": true,
                "description": "The ID of the Slack integration connection (OAuth or webhook). Find this in Settings > Integrations > Slack."
              },
              {
                "id": "slackChannel",
                "label": "Slack Channel",
                "type": "text",
                "required": false,
                "description": "Slack channel to post to (e.g. #security-alerts). Required for OAuth connections, ignored for webhook connections.",
                "default": "#general"
              },
              {
                "id": "dashboardBaseUrl",
                "label": "Dashboard Base URL",
                "type": "text",
                "required": false,
                "description": "Base URL of your deployment (e.g. https://your-domain). Used to build the analytics dashboard link in the Slack notification.",
                "default": "http://localhost"
              }
            ]
          },
          "inputOverrides": {}
        }
      }
    },
    {
      "id": "resolve-creds-1",
      "type": "core.integration.resolve-credentials",
      "position": { "x": 450, "y": 280 },
      "data": {
        "label": "Resolve AWS Credentials",
        "config": {
          "params": { "provider": "aws" },
          "inputOverrides": {}
        }
      }
    },
    {
      "id": "resolve-slack-creds-1",
      "type": "core.integration.resolve-credentials",
      "position": { "x": 100, "y": 550 },
      "data": {
        "label": "Resolve Slack Credentials",
        "config": {
          "params": { "provider": "slack" },
          "inputOverrides": {}
        }
      }
    },
    {
      "id": "prowler-1",
      "type": "security.prowler.scan",
      "position": { "x": 450, "y": 510 },
      "data": {
        "label": "Prowler Security Scan",
        "config": {
          "params": {
            "scanMode": "aws",
            "recommendedFlags": ["severity-high-critical", "ignore-exit-code", "no-banner"]
          },
          "inputOverrides": {}
        }
      }
    },
    {
      "id": "slack-1",
      "type": "core.notification.slack",
      "position": { "x": 300, "y": 770 },
      "data": {
        "label": "Slack Scan Summary",
        "config": {
          "params": {
            "authType": "credentials",
            "variables": [
              { "name": "scanSummary", "type": "json" },
              { "name": "dashboardBaseUrl", "type": "string" }
            ]
          },
          "inputOverrides": {
            "text": "ðŸ”’ *Prowler Security Scan Complete*\n\nðŸ“Š *Summary*\nâ€¢ Total findings: {{totalFindings}}\nâ€¢ Failed: {{failed}} | Passed: {{passed}}\nâ€¢ Regions: {{regions}}\n\nðŸ”´ Critical: {{critical}} | ðŸŸ  High: {{high}} | ðŸŸ¡ Medium: {{medium}} | ðŸŸ¢ Low: {{low}}\n\nðŸ“ˆ <{{dashboardBaseUrl}}/analytics/app/data-explorer/discover/#?_a=(discover%3A(columns%3A!(_source)%2Cinterval%3Aauto%2Csort%3A!())%2Cmetadata%3A(indexPattern%3A'security-findings-*'%2Cview%3Adiscover))&_q=(query%3A(language%3Akuery%2Cquery%3A'shipsec.run_id.keyword%3A%22{{runId}}%22'))&_g=(filters%3A!()%2CrefreshInterval%3A(pause%3A!t%2Cvalue%3A0)%2Ctime%3A(from%3Anow-1y%2Cto%3Anow))|View Findings in Dashboard>\n\nGenerated at {{generatedAt}}"
          }
        }
      }
    }
  ],
  "edges": [
    {
      "id": "e-entry-to-resolve",
      "source": "entry-1",
      "target": "resolve-creds-1",
      "sourceHandle": "connectionId",
      "targetHandle": "connectionId"
    },
    {
      "id": "e-entry-to-resolve-regions",
      "source": "entry-1",
      "target": "resolve-creds-1",
      "sourceHandle": "regions",
      "targetHandle": "regions"
    },
    {
      "id": "e-entry-to-slack-resolver",
      "source": "entry-1",
      "target": "resolve-slack-creds-1",
      "sourceHandle": "slackConnectionId",
      "targetHandle": "connectionId"
    },
    {
      "id": "e-resolve-to-prowler-creds",
      "source": "resolve-creds-1",
      "target": "prowler-1",
      "sourceHandle": "data",
      "targetHandle": "credentials"
    },
    {
      "id": "e-resolve-to-prowler-account",
      "source": "resolve-creds-1",
      "target": "prowler-1",
      "sourceHandle": "accountId",
      "targetHandle": "accountId"
    },
    {
      "id": "e-entry-to-prowler-regions",
      "source": "entry-1",
      "target": "prowler-1",
      "sourceHandle": "regions",
      "targetHandle": "regions"
    },
    {
      "id": "e-slack-resolver-to-slack",
      "source": "resolve-slack-creds-1",
      "target": "slack-1",
      "sourceHandle": "data",
      "targetHandle": "credentials"
    },
    {
      "id": "e-entry-to-slack-channel",
      "source": "entry-1",
      "target": "slack-1",
      "sourceHandle": "slackChannel",
      "targetHandle": "channel"
    },
    {
      "id": "e-prowler-to-slack-summary",
      "source": "prowler-1",
      "target": "slack-1",
      "sourceHandle": "summary",
      "targetHandle": "scanSummary"
    },
    {
      "id": "e-entry-to-slack-dashboard-url",
      "source": "entry-1",
      "target": "slack-1",
      "sourceHandle": "dashboardBaseUrl",
      "targetHandle": "dashboardBaseUrl"
    }
  ],
  "viewport": { "x": 0, "y": 0, "zoom": 1 }
}
